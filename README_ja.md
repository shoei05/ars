# ARS Canvas v3 — オーディエンスレスポンス（日本語README）

**見やすさ・使いやすさ重視**のStreamlit製オーディエンスレスポンスシステム。  
6桁の**数字ルームID**、プロジェクター向け高コントラスト表示、司会者向けの**フォーカス表示**、
**非表示（モデレーション）**、**QRコード共有**など、現場運用に必要な機能を厳選して搭載しています。

> 英語版READMEは [README.md](README.md) を参照してください。

---

## ✨ 特徴（v3の改善点）
- **プロジェクター前提のタイポ＆余白**：大きく読みやすい文字、十分なタップ/クリック領域（≥40px）
- **Stickyヘッダー**：ルーム情報・ソート・自動更新を常時表示して操作を短縮
- **グリッド表示**（参加者）と**リスト表示**を切り替え可能（列数1–3）
- **非表示/復帰（モデレーション）**：問題のある投稿を会場表示と参加者画面から即時隠せる
- **プロジェクター自動ローテ**：人気順の投稿を8秒ごとに自動で切り替え
- **新着ハイライト**：前回更新以降に入った投稿に 🆕 を表示
- **高コントラストモード** / **文字サイズ** / **表示密度（Comfy/Cozy/Compact）** をワンタッチ調整
- **6桁のルームID** と **?room=CODE** URL参加、**QRコード**生成
- **司会者PIN**（任意）で操作ロック、**投稿クローズ**スイッチ

---

## 🖥 画面モード
- **参加者**：投稿・👍投票、キーワード絞り込み、グリッド/リスト切替
- **司会者**：人気/新着ソート、**フォーカス表示**、**タグ付け**、**非表示/復帰**、**投稿クローズ**
- **プロジェクター**：フォーカス中の投稿を大きく表示。**自動ローテ**も可能

---

## 🚀 セットアップ & 起動
```bash
pip install -r requirements.txt
streamlit run app.py
```
ブラウザで表示されたURLを開いてください。

---

## 🌐 デプロイ（Streamlit Community Cloud）
1. 本プロジェクトをGitHubにpush  
2. Streamlit Community Cloudで **New app** → リポジトリ/ブランチを選択 → `app.py` を指定  
3. 起動後、共有したいルームで **「参加用URLとQR」** を開き、
   `https://your-app.streamlit.app?room=123456` の形式で配布してください

---

## 🔢 ルームID / 参加URL / QR
- **ルームID**：6桁の数字（例 `128947`）。任意指定も自動生成も可能
- **URL参加**：`?room=128947` を付けたリンクで直接参加
- **QR**：アプリ内でその場生成（ベースURLを指定すると絶対URLのQRになります）

---

## 🧑‍💼 司会者フロー（例）
1. サイドバー **「ルーム作成」** → タイトル、（任意で）6桁ID、**司会者PIN** を設定  
2. 参加者へ **ID** または **URL/QR** を配布  
3. 「司会者」モードで  
   - 質問/意見の**人気順**や**新着**を見ながら、**Focus** で会場に拡大表示  
   - 必要に応じて**タグ**追加、**非表示**でモデレーション、**投稿クローズ**で締め切り  
4. 会場スクリーンは **「プロジェクター」** モードで同じルームを表示（高コントラスト推奨）  
   - 自動ローテONで、人気投稿が8秒ごとに切り替わります

---

## 🗂 ディレクトリ構成
```
.
├─ app.py                 # アプリ本体
├─ requirements.txt
├─ README.md              # 英語README
├─ README_ja.md           # このファイル
├─ .streamlit/
│  └─ config.toml         # テーマ設定
└─ data/
   └─ ars.sqlite          # SQLiteデータ（初回起動時に自動作成）
```

---

## 💾 データ（SQLite）
- DBファイル：`data/ars.sqlite`（自動作成）  
- テーブル：
  - `rooms(code, title, created_at, focus_comment_id, admin_pin, is_closed)`
  - `comments(id, room_code, author, content, votes, tags, hidden, created_at)`

> デフォルトは**認証なし**・**ローカルDB**です。商用利用には外部DB（例：Supabase/Firestore）や認証、
> レート制限、監査ログなどの導入を推奨します。

---

## 🎨 カスタマイズ
- **テーマ**（色/フォント/角丸/影）：`app.py` のCSS（`PAGE_CSS`）を調整
- **ルームID桁数**や英数字混在、**PINの必須化**も容易に変更可能
- **クラスタリング**は scikit-learn（TF-IDF + KMeans）で簡易実装。必要に応じて固有表現/辞書の拡張可

---

## 🔒 注意点（運用）
- 公開URLの場合は**荒らし対策**として「司会者PIN」「投稿クローズ」「非表示」を活用してください
- 大規模イベントでは**外部DB**と**CDN**、**レート制限**を検討してください
- 個人情報や機微情報の投稿は避ける設計/案内が望ましいです

---

## 📝 ライセンス
MIT License


> メモ: `data/` は自動作成されます。GitHubに空ディレクトリを保持したい場合は `data/.gitkeep` を置いてください。
